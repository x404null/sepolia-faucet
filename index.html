<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pixel Minesweeper</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    background: #7b7b7b;
    font-family: "Courier New", monospace;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .game {
    background: #c0c0c0;
    padding: 10px;
    border: 4px solid #fff;
    box-shadow:
      inset -4px -4px #808080,
      inset 4px 4px #fff;
  }

  h1 {
    text-align: center;
    font-size: 16px;
    margin: 4px 0 6px;
  }

  .top {
    display: flex;
    justify-content: space-between;
    background: #bdbdbd;
    padding: 4px;
    border: 2px solid #808080;
    margin-bottom: 6px;
  }

  select, button {
    font-family: inherit;
    font-size: 12px;
    padding: 2px 6px;
    background: #c0c0c0;
    border: 2px solid #fff;
    box-shadow:
      inset -2px -2px #808080,
      inset 2px 2px #fff;
    cursor: pointer;
  }

  button:active {
    box-shadow:
      inset 2px 2px #808080,
      inset -2px -2px #fff;
  }

  .grid {
    display: grid;
    gap: 0;
    background: #808080;
    padding: 2px;
  }

  .cell {
    width: 26px;
    height: 26px;
    background: #c0c0c0;
    border: 2px solid #fff;
    box-shadow:
      inset -2px -2px #808080,
      inset 2px 2px #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    cursor: pointer;
    user-select: none;
  }

  .cell.open {
    background: #bdbdbd;
    border: 1px solid #808080;
    box-shadow: none;
    cursor: default;
  }

  .cell.mine {
    background: #ff4d4d;
  }

  .info {
    text-align: center;
    font-size: 12px;
    margin-top: 6px;
  }
</style>
</head>

<body>

<div class="game">
  <h1>ðŸ’£ PIXEL MINESWEEPER</h1>

  <div class="top">
    <select id="level">
      <option value="easy">Easy</option>
      <option value="medium">Medium</option>
      <option value="hard">Hard</option>
    </select>
    <button onclick="newGame()">New</button>
  </div>

  <div class="grid" id="grid"></div>
  <div class="info" id="info">Click to start</div>
</div>

<script>
/* ===== SOUND (8-BIT STYLE) ===== */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function beep(freq, time) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.frequency.value = freq;
  osc.type = "square";
  gain encourage
  gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
  osc.start();
  osc.stop(audioCtx.currentTime + time);
}

const sound = {
  click: () => beep(600, 0.05),
  open: () => beep(800, 0.08),
  boom: () => beep(120, 0.3),
  win: () => beep(1000, 0.2)
};

/* ===== GAME LOGIC ===== */
const gridEl = document.getElementById("grid");
const infoEl = document.getElementById("info");

const levels = {
  easy: { size: 8, mines: 10 },
  medium: { size: 10, mines: 20 },
  hard: { size: 12, mines: 35 }
};

let size, mineCount, board, revealed, gameOver;

function newGame() {
  const lvl = levels[document.getElementById("level").value];
  size = lvl.size;
  mineCount = lvl.mines;
  revealed = 0;
  gameOver = false;
  infoEl.innerText = "Good luck ðŸ˜ˆ";

  gridEl.style.gridTemplateColumns = `repeat(${size}, 26px)`;
  board = Array.from({ length: size * size }, () => ({
    mine: false,
    open: false,
    count: 0
  }));

  placeMines();
  countMines();
  render();
}

function placeMines() {
  let placed = 0;
  while (placed < mineCount) {
    const i = Math.floor(Math.random() * board.length);
    if (!board[i].mine) {
      board[i].mine = true;
      placed++;
    }
  }
}

function countMines() {
  for (let i = 0; i < board.length; i++) {
    if (board[i].mine) continue;
    board[i].count = neighbors(i).filter(n => board[n].mine).length;
  }
}

function neighbors(i) {
  const x = i % size;
  const y = Math.floor(i / size);
  const list = [];
  for (let dy = -1; dy <= 1; dy++) {
    for (let dx = -1; dx <= 1; dx++) {
      if (dx === 0 && dy === 0) continue;
      const nx = x + dx, ny = y + dy;
      if (nx >= 0 && nx < size && ny >= 0 && ny < size) {
        list.push(ny * size + nx);
      }
    }
  }
  return list;
}

function render() {
  gridEl.innerHTML = "";
  board.forEach((cell, i) => {
    const d = document.createElement("div");
    d.className = "cell";
    if (cell.open) {
      d.classList.add("open");
      if (cell.mine) {
        d.classList.add("mine");
        d.innerText = "ðŸ’£";
      } else if (cell.count > 0) {
        d.innerText = cell.count;
      }
    }
    d.onclick = () => clickCell(i);
    gridEl.appendChild(d);
  });
}

function clickCell(i) {
  if (gameOver || board[i].open) return;
  sound.click();

  board[i].open = true;

  if (board[i].mine) {
    sound.boom();
    revealAll();
    infoEl.innerText = "ðŸ’¥ BOOM!";
    gameOver = true;
    render();
    return;
  }

  revealed++;
  sound.open();

  if (board[i].count === 0) {
    neighbors(i).forEach(n => {
      if (!board[n].open) clickCell(n);
    });
  }

  if (revealed === size * size - mineCount) {
    sound.win();
    infoEl.innerText = "ðŸŽ‰ YOU WIN!";
    gameOver = true;
  }

  render();
}

function revealAll() {
  board.forEach(c => c.open = true);
}

newGame();
</script>

</body>
</html>
